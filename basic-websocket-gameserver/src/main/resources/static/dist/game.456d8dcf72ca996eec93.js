!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}([function(e,t){e.exports=Object.freeze({PLAYER_RADIUS:25,BULLET_RADIUS:3,MAP_SIZE:2e3})},function(e,t,n){!function(e){"use strict";function t(e,t,n,r){var o,i=!1,a=0;function c(){o&&clearTimeout(o)}function u(){for(var u=arguments.length,l=new Array(u),s=0;s<u;s++)l[s]=arguments[s];var d=this,f=Date.now()-a;function m(){a=Date.now(),n.apply(d,l)}function y(){o=void 0}i||(r&&!o&&m(),c(),void 0===r&&f>e?m():!0!==t&&(o=setTimeout(r?y:m,void 0===r?e-f:e)))}return"boolean"!=typeof t&&(r=n,n=t,t=void 0),u.cancel=function(){c(),i=!0},u}e.debounce=function(e,n,r){return void 0===r?t(e,n,!1):t(e,r,!1!==n)},e.throttle=t,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){var r=n(8).Symbol;e.exports=r},function(e,t,n){var r=n(4),o=n(6),i=/[&<>"']/g,a=RegExp(i.source);e.exports=function(e){return(e=o(e))&&a.test(e)?e.replace(i,r):e}},function(e,t,n){var r=n(5)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=r},function(e,t){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},function(e,t,n){var r=n(7);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(2),o=n(11),i=n(12),a=n(13),c=r?r.prototype:void 0,u=c?c.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return o(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t,n){var r=n(9),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();e.exports=i},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(10))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){var r=n(14),o=n(17);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==r(e)}},function(e,t,n){var r=n(2),o=n(15),i=n(16),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?o(e):i(e)}},function(e,t,n){var r=n(2),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,c=r?r.toStringTag:void 0;e.exports=function(e){var t=i.call(e,c),n=e[c];try{e[c]=void 0;var r=!0}catch(e){}var o=a.call(e);return r&&(t?e[c]=n:delete e[c]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"enterKeyBoard",(function(){return be}));var r=n(1),o=n(3),i=n.n(o),a=document.getElementById("leaderboard"),c=document.querySelectorAll("#leaderboard table tr");function u(e){e?a.classList.add("hidden"):a.classList.remove("hidden")}var l=[],s=0,d=0;function f(e){d||(d=e.t,s=Date.now()),l.push(e),function(e){for(var t=0;t<e.length;t++)c[t+1].innerHTML="<td>".concat(i()(e[t].username.slice(0,15))||"Anonymous","</td><td>").concat(e[t].score,"</td>");for(var n=e.length;n<5;n++)c[n+1].innerHTML="<td>-</td><td>-</td>"}(e.leaderboard);var t=y();t>0&&l.splice(0,t)}function m(){return d+(Date.now()-s)-100}function y(){for(var e=m(),t=l.length-1;t>=0;t--)if(l[t].t<=e)return t;return-1}function v(){if(!d)return{};var e=y(),t=m();if(e<0||e===l.length-1)return l[l.length-1];var n=l[e],r=l[e+1],o=(t-n.t)/(r.t-n.t);return{me:p(n.me,r.me,o),others:g(n.others,r.others,o),bullets:g(n.bullets,r.bullets,o),meteors:g(n.meteors,r.meteors,o)}}function p(e,t,n){if(!t)return e;var r={};return Object.keys(e).forEach((function(o){r[o]="direction"===o?function(e,t,n){return Math.abs(t-e)>=Math.PI?e>t?e+(t+2*Math.PI-e)*n:e-(t-2*Math.PI-e)*n:e+(t-e)*n}(e[o],t[o],n):"x"===o||"y"===o||"hp"===o?e[o]+(t[o]-e[o])*n:e[o]})),r}function g(e,t,n){return e.map((function(e){return p(e,t.find((function(t){return e.id===t.id})),n)}))}var h,b=n(0),w=n.n(b),E=new WebSocket("ws://localhost:8080/room/".concat(1)),S=new Promise((function(e){E.onopen=function(){console.log("Connected to web socket game server!"),e()}})),x=Object(r.throttle)(20,(function(e){var t;87===e?t="North":83===e?t="South":68===e?t="East":65===e&&(t="West");var n={type:"cmove",protocol:"C_Move",posInfo:{pos:{},dirs:[],state:null},dir:t,updown:!0};E.send(JSON.stringify(n))})),I={skillId:1,name:"bullet",damage:w.a.BULLET_DAMAGE,skillType:"BULLET",projectile:{speed:w.a.BULLET_SPEED,range:w.a.BULLET_RADIUS}},A={skillId:2,name:"shield",damage:0,skillType:"SHIELD"},j={},k=Promise.all(["ship.svg","bullet.svg","icon64.png","plane.png","octagon.png","circle.png","target.png","meteor.png"].map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){console.log("Downloaded ".concat(e)),j[e]=n,t()},n.src="/assets/".concat(e)}))})));var L=function(e){return j[e]},O=document.getElementById("game-canvas"),_=O.getContext("2d");n(0).MAP_SIZE;var C=function(e,t){_.fillStyle="black",_.fillRect(0,0,O.width,O.height),_.strokeStyle="white",_.lineWidth=.5,O.width,O.height},P=n(0).PLAYER_RADIUS,B=document.getElementById("game-canvas"),M=B.getContext("2d");var T=function(e,t){var n=t.x,r=t.y,o=t.direction,i=B.width/2+n-e.x,a=B.height/2+r-e.y;M.save(),M.translate(i,a),M.rotate(o),M.drawImage(L("circle.png"),-P,-P,2*P,2*P),M.restore()},D=document.getElementById("game-canvas"),U=D.getContext("2d"),R=n(0).MAP_SIZE;var F=function(e){U.strokeStyle="white",U.lineWidth=5,U.strokeRect(D.width/2-e.x,D.height/2-e.y,R,R)},N=n(0).PLAYER_RADIUS,q=document.getElementById("game-canvas"),J=q.getContext("2d");var W=function(e,t){var n=t.x,r=t.y,o=t.direction,i=t.word,a=q.width/2+n-e.x,c=q.height/2+r-e.y;J.save(),J.translate(a,c),J.rotate(o),J.drawImage(L("meteor.png"),-N,-N,2*N,2*N),J.restore(),J.fillStyle="white",J.font="20px Arial",J.textAlign="center",J.fillText(i,a,c+N+20)};function Y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var H=n(0),z=document.getElementById("game-canvas"),G=H.PLAYER_RADIUS;H.MAP_SIZE;function $(e){87!==e.keyCode&&83!==e.keyCode&&68!==e.keyCode&&65!==e.keyCode||x(e.keyCode),13===e.keyCode&&be()}function K(e){87!==e.keyCode&&83!==e.keyCode&&68!==e.keyCode&&65!==e.keyCode||function(e){var t;87===e?t="North":83===e?t="South":68===e?t="East":65===e&&(t="West");var n={type:"cmove",protocol:"C_Move",posInfo:{pos:{},dirs:[],state:null},dir:t,updown:!1};E.send(JSON.stringify(n))}(e.keyCode)}function X(e){var t=z.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,o=v().me;!function(e,t){var n,r=v().others,o=v().meteors,i=Y(r);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(Math.hypot(a.x-e,a.y-t)<G)return console.log("hi"),void(Q=a.id)}}catch(e){i.e(e)}finally{i.f()}var c,u=Y(o);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(Math.hypot(l.x-e,l.y-t)<G)return console.log("hi"),void(Q=l.id)}}catch(e){u.e(e)}finally{u.f()}Q=-1}(o.x+(n-z.width/2),o.y+(r-z.height/2))}var Q=-1;function V(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var te=document.getElementById("game-canvas"),ne=te.getContext("2d");var re=function(){var e=v(),t=e.me,n=e.others,r=e.meteors,o=[].concat(V(n),V(r)).find((function(e){return e.id===Q}));if(o){var i=o.x,a=o.y,c=te.width/2+i-t.x,u=te.height/2+a-t.y,l=L("target.png");ne.drawImage(l,c-l.width/16,u-l.height/16,l.width/8,l.height/8)}},oe=document.getElementById("game-canvas"),ie=oe.getContext("2d"),ae=n(0).BULLET_RADIUS;var ce,ue=function(e,t){var n=t.x,r=t.y;ie.drawImage(L("bullet.svg"),oe.width/2+n-e.x-ae,oe.height/2+r-e.y-ae,2*ae,2*ae)},le=n(0).MAP_SIZE,se=document.getElementById("game-canvas");function de(){se.width=1200,se.height=800}function fe(){var e=v(),t=e.me,n=e.others,r=e.bullets,o=e.meteors;t&&(C(t.x,t.y),F(t),re(),r.forEach(ue.bind(null,t)),o.forEach(W.bind(null,t)),T(t,t),n.forEach(T.bind(null,t))),ce=requestAnimationFrame(fe)}function me(){Date.now();C(le/2,le/2),ce=requestAnimationFrame(me)}de(),window.addEventListener("resize",Object(r.debounce)(40,de)),ce=requestAnimationFrame(me);n(18),n(19);var ye,ve=document.getElementById("play-menu"),pe=document.getElementById("play-button"),ge=document.getElementById("username-input"),he=document.getElementById("inputbar");Promise.all([(ye=function(){window.removeEventListener("click",X),window.removeEventListener("keydown",$),window.removeEventListener("keyup",K),cancelAnimationFrame(ce),ce=requestAnimationFrame(me),ve.classList.remove("hidden"),u(!0)},S.then((function(){E.onmessage=function(e){var t=JSON.parse(e.data);if("sentergame"===t.type)h=t.player.objectId,console.log("enter game!! ".concat(h));else if("sspawn"===t.type)console.log("spawn!!");else if("supdate"===t.type){var n=t.update.others.find((function(e){return e.id===h})),r=t.update.others.indexOf(n);r>-1&&t.update.others.splice(r,1),f({t:t.update.t,me:n,others:t.update.others,bullets:t.update.bullets,meteors:t.update.meteors,leaderboard:t.update.leaderboard})}else"smove"===t.type||"schat"===t.type||"sskill"===t.type||"sdie"===t.type&&(console.log("sdie"),t.objectId===h&&ye())},E.onclose=function(){console.log("Disconnected from server."),document.getElementById("disconnect-modal").classList.remove("hidden"),document.getElementById("reconnect-button").onclick=function(){window.location.reload()}}}))),k]).then((function(){ve.classList.remove("hidden"),ge.focus(),pe.onclick=function(){var e,t;e=ge.value,t={type:"centergame",protocol:"C_EnterGame",username:e},E.send(JSON.stringify(t)),ve.classList.add("hidden"),s=0,d=0,window.addEventListener("click",X),window.addEventListener("keydown",$),window.addEventListener("keyup",K),cancelAnimationFrame(ce),ce=requestAnimationFrame(fe),u(!1)}})).catch(console.error);var be=Object(r.throttle)(10,(function(){if(document.activeElement===he)Q>0&&(""===he.value.trim()?(console.log("입력 실패, 메세지를 입력해 주세요!"),he.blur()):(!function(e,t,n,r){var o={type:"cskill",protocol:"C_Skill",target:e,info:!0===n?I:A};E.send(JSON.stringify(o))}(Q,he.value,!0),he.value="",he.blur()));else{if(Q<0)return void console.log("타겟이 지정되지 않았음!");he.focus()}}))}]);